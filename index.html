<html lang="pt-br">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/md5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/aes.min.js" integrity="sha512-4b1zfeOuJCy8B/suCMGNcEkMcQkQ+/jQ6HlJIaYVGvg2ZydPvdp7GY0CuRVbNpSxNVFqwTAmls2ftKSkDI9vtA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/hmac-sha256.min.js" integrity="sha512-HMqYytekgCbPoNWBm9oazvuOJ8sFpw+FWBHRi2QM0f/bV5djDV1sRzWzu5Jq7MAUlm+zDAUCgi/vHBBlUGLroQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <title>Notas</title>
    <style>
    .titulo{
        color:red;
    }
    .nota{
        margin:10px;
        border:3px black solid;
    }
    ></style>
</head>
<body>

<div>
<form class="row g-3">
<div class="col-auto">
    <label class="visually-hidden">Matricula</label>
    <input class="form-control"  id="matricula" value="" placeholder="matricula"/>
</div>
<div class="col-auto">
<input class="btn btn-primary mb-3" type='button' value="Buscar" onclick="buscar(this)"/>
</div>
</form>

</div>

<div id="notas">
</div>

<script>


var json="";
var matricula="";
var hashmatricula;
function buscar(){
    matricula = document.getElementById("matricula").value;
    hashmatricula = CryptoJS.MD5(matricula).toString();
    console.log(hashmatricula);
    json= ""+httpGet("json/"+hashmatricula+'.json');
    
    jsondecode= CryptoJS.AES.decrypt(json,matricula).toString( CryptoJS.enc.Utf8 );
    console.log(json);
    console.log(jsondecode);
    
    jsondecode=JSON.parse(jsondecode)
    load(jsondecode);
}

function loadNotas(aluno){
    var raiz = document.getElementById("notas");
    
    for (var [key, value] of Object.entries(aluno)) {
        
        console.log(key + ' ' + value);  
        var id=value['id'];
        var nome=value['nome'];
        var peso=value['peso'];
        var nota=value['nota'];
        var etapa=value['etapa'];
        var feedback=value['feedback'];
        
        if(nome === undefined){
            continue;
        }
        var div = document.createElement('div');
        div.classList.add('nota')

        var node = document.createElement('b');
        node.classList.add('titulo')
        node.innerHTML =nome+" - "+id;
        div.appendChild(node);

        var node = document.createElement('div');
        node.innerHTML =`Etapa: ${etapa}`;
        div.appendChild(node);

        var node = document.createElement('div');
        node.innerHTML =`peso: ${peso} %`;
        div.appendChild(node);

        var node = document.createElement('div');
        node.innerHTML =`nota: <b>${nota}</b> de 100 pontos`;
        div.appendChild(node);

        raiz.appendChild(div);
    }

}
function load(aluno){
    var raiz = document.getElementById("notas");
    while (raiz.firstChild) {
        raiz.firstChild.remove()
    }
    for (var [key, value] of Object.entries(aluno) ){
        var node = document.createElement('h1');
        node.innerHTML =value['nome']+"-"+key;
        raiz.appendChild(node);

        for (var k in value['notas']){
            var n=value['notas'][k];
            if(n === null){
                n='';
            }
            var nodez = document.createElement('div');
            nodez.innerHTML = `<b>${k}</b> : ${n}`;
            raiz.appendChild(nodez);
        }


        loadNotas(value);
    }
}   


function httpGet(theUrl)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.open( "GET", theUrl, false ); // false for synchronous request
 
 
    xmlHttp.send( null );
    if (xmlHttp.status == 404){
        alert("NÃ£o foi possivel localizar");
        return "";
    }else
        return xmlHttp.responseText;
}

//var json= JSON.parse(httpGet('20181INFI_PINHE0020.json'));
//console.log(json);
//load(json);
</script>


</body>

</html>